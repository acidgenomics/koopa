#!/usr/bin/env bash
set -Eeu -o pipefail

script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd -P)"
# shellcheck source=/dev/null
source "${script_dir}/../include/header.sh"

_koopa_assert_has_no_args "$@"

if ! _koopa_is_installed brew
then
    _koopa_warning "Homebrew is not installed."
    exit 0
fi

_koopa_h1 "Updating Homebrew."

brew analytics off
brew update

_koopa_h2 "Updating brews."

brew upgrade --force-bottle
# > brew list | xargs brew reinstall --force-bottle --cleanup

_koopa_h2 "Updating casks."

casks="$(brew cask outdated)"
if [[ -n "$casks" ]]
then
    brew cask outdated | xargs brew cask reinstall
fi

_koopa_h2 "Running cleanup."

brew cleanup -s
rm -frv "$(brew --cache)"

_koopa_success "Homebrew updated successfully."
