#!/usr/bin/env bash
set -Eeu -o pipefail

# shellcheck source=/dev/null
source "$(koopa header darwin)"

# Install recommended Homebrew recipes.
# Updated 2019-09-14.

_koopa_assert_is_installed brew

export HOMEBREW_FORCE_BOTTLE=1



# Notes                                                                     {{{1
# ==============================================================================

# Use CRAN R cask (R.app) instead of Homebrew R.

# Homebrew now supports a global variable to force bottle installations.
# Alternatively, can use `--force-bottle`.
# See also:
# - https://github.com/Homebrew/brew/pull/4520/files
# - https://github.com/Homebrew/brew/pull/4542/files

# Note that XQuartz v2.7.11 doesn't work well with wine.
# Install v2.7.9 directly instead.
# https://www.xquartz.org/releases/XQuartz-2.7.9.html
# brew cask install xquartz



# Casks                                                                     {{{1
# ==============================================================================

# Priority                                                                  {{{2
# ------------------------------------------------------------------------------

brew cask install \
    java \
    osxfuse \
    xquartz

# Recommended                                                               {{{2
# ------------------------------------------------------------------------------

brew cask install \
    1password \
    alacritty \
    alfred \
    aspera-connect \
    authy \
    basictex \
    bbedit \
    bibdesk \
    coconutbattery \
    coda \
    emacs \
    fiji \
    firefox \
    github \
    google-chrome \
    google-cloud-sdk \
    google-drive-file-stream \
    gpg-suite \
    hazel \
    igv \
    iterm2 \
    keka \
    libreoffice \
    onyx \
    r \
    safari-technology-preview \
    skype \
    spillo \
    sublime-text \
    superduper \
    torbrowser \
    tower \
    transmit \
    tunnelblick \
    visual-studio-code \
    vlc \
    xld

# Gatekeeper issues                                                         {{{2
# ------------------------------------------------------------------------------

brew cask install --no-quarantine \
    calibre \
    docker \
    omnidisksweeper \
    rstudio

# Non-admin issues                                                          {{{2
# ------------------------------------------------------------------------------

# These casks have permission issues with non-admin accounts.

brew cask install \
    carbon-copy-cloner \
    dropbox \
    little-snitch \
    slack



# Brews                                                                     {{{1
# ==============================================================================

# Priority                                                                  {{{2
# ------------------------------------------------------------------------------

brew install bash fish ksh tcsh zsh
brew install flac lame tcl-tk

# Recommended                                                               {{{2
# ------------------------------------------------------------------------------

brew install \
    autoconf \
    automake \
    awscli \
    bash-completion \
    bfg \
    ccache \
    circleci \
    cmake \
    convmv \
    coreutils \
    curl \
    exa \
    exiftool \
    ffmpeg \
    findutils \
    flac \
    gcc \
    gdal \
    git \
    git-lfs \
    gsl \
    hdf5 \
    hub \
    ksh \
    leiningen \
    libav \
    libgit2 \
    libiconv \
    libressl \
    librsvg \
    libssh2 \
    libxml2 \
    libxslt \
    mariadb-connector-c \
    mas \
    md5sha1sum \
    neovim \
    node \
    open-mpi \
    pandoc \
    pandoc-citeproc \
    pandoc-crossref \
    pkg-config \
    protobuf \
    rbenv \
    rsync \
    ruby-build \
    rust \
    screen \
    shellcheck \
    shellharden \
    sshfs \
    tesseract \
    tmux \
    trash \
    tree \
    udunits \
    vim \
    wget \
    youtube-dl \
    zlib

# External recipes                                                          {{{2
# ------------------------------------------------------------------------------

brew install vitorgalvao/tiny-scripts/cask-repair

# Pesky recipes                                                             {{{2
# ------------------------------------------------------------------------------

# Additional imagemagick flags:
# - `--with-ghostscript`
# - `--with-pango`
# - `--with-webpbrew`
brew install imagemagick --with-fontconfig --with-librsvg

# LLVM full mainline: `--with-toolchain` (very slow to install).
brew install llvm

# OpenBLAS is very CPU intensive when built from source.
brew install openblas --with-openmp

brew install python --with-tcl-tk

brew install sox --with-flac --with-lame

