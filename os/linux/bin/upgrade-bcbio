#/usr/bin/env bash

# shellcheck source=/dev/null
source "$(koopa header linux)"

# Update bcbio installation.
# Updated 2019-07-17.

# Ensure conda is deactivated.
_koopa_assert_has_no_environments

log_dir="${HOME}/logs/${HOSTNAME}/bcbio"
mkdir -p "$log_dir"

bcbio_nextgen.py upgrade \
    --upgrade="stable" \
    --tools \
    --data \
    --cores="$CPU_COUNT" \
    2>&1 | tee "${log_dir}/bcbio-upgrade-$(date "+%Y%m%d_%H%M%S").log"

unset -v log_dir
