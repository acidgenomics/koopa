#!/usr/bin/env bash
set -Eeu -o pipefail

# koopa shell bootloader.
# (c) 2018 Michael Steinbaugh.
# This software is provided under an MIT License.

version="0.4.0a"
date="2019-06-18"

# Require that koopa is activate and exported to PATH.
if [[ -z "${KOOPA_OS_PLATFORM:-}" ]]
then
    >&2 printf "koopa is not correctly activated.\n"
    exit 1
fi

# Display help on empty call.
[ -z "${1:-}" ] && koopa --help && exit 0

include_dir="${KOOPA_DIR}/include"

# Source internal functions.
. "${include_dir}/functions.sh"

case "$1" in
    --help|-h)
        cat "${include_dir}/help.txt"
        exit 0
        ;;
    --version|-V)
        printf "koopa %s (%s)\n" "$version" "$date"
        exit 0
        ;;
    check)
        Rscript --vanilla "${include_dir}/check.R"
        exit 0
        ;;
    info)
        "${include_dir}/info.sh"
        exit 0
        ;;
    list)
        Rscript --vanilla "${include_dir}/list.R"
        exit 0
        ;;
    update)
        "${include_dir}/update.sh"
        exit 0
        ;;
    upgrade)
        >&2 printf "Error: Use 'update' instead of 'upgrade'.\n"
        exit 1
        ;;
    variable)
        koopa_variable "$2"
        exit 0
        ;;
    *)
        >&2 printf "Error: Unsupported command.\n"
        >&2 printf "Run 'koopa --help' for details.\n"
        exit 1
        ;;
esac
