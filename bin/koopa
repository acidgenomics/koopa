#!/usr/bin/env bash

# koopa shell bootloader
# (c) 2018 Michael Steinbaugh
# This software is provided under an MIT License.

# Here's how to properly check if a variable is set in Bash.
# https://stackoverflow.com/a/13864829

# Don't reload for HPC interactive job.
if [[ -n ${HPC_INTERACTIVE_JOB+x} ]]; then
    exit 0
fi

# Python is required.
if [[ -z "$( command -v python 2>/dev/null )" ]]; then
    echo "Python is required."
    exit 1
fi

KOOPA_VERSION="0.2.1"
KOOPA_DATE="2018-11-24"

KOOPA_EXE="${BASH_SOURCE[0]}"
KOOPA_BIN_DIR="$( dirname "$KOOPA_EXE" )"
KOOPA_BASE_DIR="$( dirname "$KOOPA_BIN_DIR" )"
KOOPA_SYS_DIR="${KOOPA_BASE_DIR}/system"
KOOPA_SYSTEM="$( python -mplatform )"

CMD="$1"

if [[ "$CMD" == "activate" ]]; then
    source "${KOOPA_SYS_DIR}/activate.sh"
elif [[ "$CMD" == "info" ]]; then
    source "${KOOPA_SYS_DIR}/info.sh"
elif [[ "$CMD" == "interactive" ]]; then
    source "${KOOPA_SYS_DIR}/interactive.sh"
elif [[ "$CMD" == "list" ]]; then
    source "${KOOPA_SYS_DIR}/list.sh"
else
    echo "koopa args: activate, info, list"
    exit 1
fi

unset -v CMD
