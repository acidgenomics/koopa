#!/usr/bin/env sh

# koopa shell bootloader
# (c) 2018 Michael Steinbaugh
# This software is provided under an MIT License.

shell=$(basename $SHELL)

if [ "$shell" = "bash" ]
then
    # chsh -s /usr/local/bin/bash
    KOOPA_EXE="${BASH_SOURCE[0]}"
elif [ "$shell" = "zsh" ]
then
    # chsh -s /usr/local/bin/zsh
    # https://unix.stackexchange.com/questions/76505
    KOOPA_EXE="$0:A"
else
    echo "koopa is compatible with bash or zsh shell."
    echo "Check your configuration."
    echo "Unsupported shell: $SHELL"
    return 1
fi

cmd="$1"

KOOPA_BIN_DIR="$( dirname "$KOOPA_EXE" )"
KOOPA_BASE_DIR="$( dirname "$KOOPA_BIN_DIR" )"
KOOPA_FUNCTIONS_DIR="${KOOPA_BASE_DIR}/functions"
KOOPA_SYSTEM_DIR="${KOOPA_BASE_DIR}/system"

if [ "$cmd" = "activate" ]
then
    # shellcheck source=/dev/null
    . "${KOOPA_SYSTEM_DIR}/activate.sh"
elif [ "$cmd" = "info" ]
then
    # shellcheck source=/dev/null
    bash "${KOOPA_SYSTEM_DIR}/info.sh"
elif [ "$cmd" = "list" ]
then
    # shellcheck source=/dev/null
    bash "${KOOPA_SYSTEM_DIR}/list.sh"
else
    echo "koopa args: activate, info, list"
    exit 1
fi

unset -v cmd shell
