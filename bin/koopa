#!/usr/bin/env bash
set -Eeu -o pipefail

# koopa shell bootloader.
# (c) 2018 Michael Steinbaugh.
# This software is provided under an MIT License.

cmd="$*"

version="0.4.0a"
date="2019-06-17"

# Require that koopa is activate and exported to PATH.
if [[ -z "${KOOPA_OS_PLATFORM:-}" ]]
then
    >&2 printf "koopa is not correctly activated.\n"
    exit 1
fi

# Display help on empty call.
[ -z "${cmd}" ] && koopa --help && exit 0

cmd_dir="${KOOPA_DIR}/include"

case "$cmd" in
    --help|-h)
        cat "${cmd_dir}/help.txt"
        exit 0
        ;;
    --version|-V)
        printf "koopa %s (%s)\n" "$version" "$date"
        exit 0
        ;;
    check)
        Rscript --vanilla "${cmd_dir}/check.R"
        exit 0
        ;;
    info)
        "${cmd_dir}/info.sh"
        exit 0
        ;;
    list)
        Rscript --vanilla "${cmd_dir}/list.R"
        exit 0
        ;;
    update)
        "${cmd_dir}/update.sh"; exit 0;;
    upgrade)
        >&2 printf "Error: Use 'update' instead of 'upgrade'.\n"
        exit 1
        ;;
    *)
        >&2 printf "Error: Unsupported command.\n"
        >&2 printf "Run 'koopa --help' for details.\n"
        exit 1
        ;;
esac
