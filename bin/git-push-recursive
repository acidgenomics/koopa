#!/usr/bin/env bash
set -Eeu -o pipefail

KOOPA_HOME="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." \
    >/dev/null 2>&1 && pwd -P)"
# shellcheck source=/dev/null
source "${KOOPA_HOME}/shell/bash/include/header.sh"

dir="${1:-"."}"

# SC2044: For loops over find output are fragile.
# Using '-L' flag here in case git dir is a symlink.
while IFS= read -r -d '' repo
do
    repo="$(dirname "$repo")"
    (
        cd "$repo" || exit 1
        pwd
        git push
    )
done <   <(find -L "$dir" -maxdepth 2 -type d -name ".git" -print0)
