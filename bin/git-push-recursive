#!/usr/bin/env bash
set -Eeu -o pipefail

# shellcheck source=/dev/null
source "$(_koopa_header bash)"

# Push all repositories recursively.
# Updated 2019-06-25.

git_dir="${1:-.}"

# SC2044: For loops over find output are fragile.
# Using `-L` flag here in case git dir is a symlink.
while IFS= read -r -d '' repo
do
    repo="$(dirname "$repo")"
    (
        cd "$repo" || exit 1
        pwd
        git push
    )
done <   <(find -L "$git_dir" -maxdepth 2 -type d -name ".git" -print0)

unset -v git_dir
