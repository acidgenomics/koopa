#!/usr/bin/env bash
set -Eeu -o pipefail

KOOPA_PREFIX="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." \
    >/dev/null 2>&1 && pwd -P)"
# shellcheck source=/dev/null
source "${KOOPA_PREFIX}/shell/bash/include/header.sh"
_koopa_assert_has_args "$@"
_koopa_assert_is_installed "curl"

organism="$1"

case "$organism" in
    "Homo sapiens")
        short_name="human"
        pattern="Release [0-9]+"
        ;;
    "Mus musculus")
        short_name="mouse"
        pattern="Release M[0-9]+"
        ;;
    *)
        _koopa_stop "Unsupported organism: '${organism}'."
        ;;
esac

base_url="https://www.gencodegenes.org"
url="${base_url}/${short_name}/"

curl --silent "$url" \
    | grep -Eo "$pattern" \
    | head -n 1 \
    | cut -d ' ' -f 2
