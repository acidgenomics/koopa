#!/usr/bin/env bash
set -Eeu -o pipefail

# shellcheck source=/dev/null
source "$(koopa header bash)"

# Install Doom Emacs.
# Updated 2019-09-20.

name="doom"
repo="https://github.com/hlissner/doom-emacs"

emacs_home="${HOME}/.emacs.d"
install_dir="${emacs_home}-${name}"
exe_file="${install_dir}/bin/doom"

# FIXME Switch to assert
if [[ -d "$install_dir" ]]
then
    >&2 printf "Error: Directory exists: '%s'.\n" "$install_dir"
    exit 1
fi

git clone "$repo" "$install_dir"
link-emacs "$name"

"${exe_file}" quickstart
"${exe_file}" refresh
"${exe_file}" doctor
