#!/usr/bin/env bash

script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd -P)"
# shellcheck source=/dev/null
source "${script_dir}/../shell/bash/include/header.sh"

# """
# > rbenv install -l
#
# Ensure installation uses system OpenSSL.
# > export RUBY_CONFIGURE_OPTS=--with-openssl-dir=/usr
# """

koopa::assert_is_installed rbenv

version="$(koopa::variable ruby)"
# Ensure '2.6.5p' becomes '2.6.5', for example.
version="$(koopa::sanitize_version "$version")"

# Ensure ruby-build is current.
ruby_build_dir="/usr/local/rbenv/plugins/ruby-build"
if [[ -d "$ruby_build_dir" ]]
then
    koopa::note "Updating ruby-build plugin: '${ruby_build_dir}."
    (
        cd "$ruby_build_dir" || exit 1
        git pull --quiet
    )
fi

rbenv install "$version"
rbenv global "$version"

# > rbenv versions
