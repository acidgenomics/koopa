#!/usr/bin/env bash

KOOPA_HOME="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." \
    >/dev/null 2>&1 && pwd -P)"
# shellcheck source=/dev/null
source "${KOOPA_HOME}/shell/bash/include/header.sh"



# Notes                                                                     {{{1
# ==============================================================================

# > rbenv install -l

# Ensure installation uses system OpenSSL.
# > export RUBY_CONFIGURE_OPTS=--with-openssl-dir=/usr



# Usage                                                                     {{{1
# ==============================================================================

usage() {
cat << EOF
$(_koopa_help_header)

Install recommended Ruby release via rbenv.

$(_koopa_help_args)

see also:
    - https://github.com/rbenv/ruby-build
    - https://github.com/rbenv/ruby-build/wiki
    - https://github.com/rbenv/ruby-build/issues/377

note:
    Bash script.
    Updated 2019-09-25.
EOF
}

_koopa_help "$@"



# Script                                                                    {{{1
# ==============================================================================

_koopa_assert_is_installed rbenv
_koopa_assert_has_no_environments

version="$(_koopa_variable ruby)"

# Ensure ruby-build is current.
ruby_build_dir="/usr/local/rbenv/plugins/ruby-build"
if [[ -d "$ruby_build_dir" ]]
then
    printf "Updating ruby-build plugin: %s\n" "$ruby_build_dir"
    (
        cd "$ruby_build_dir" || exit 1
        git pull
    )
fi

rbenv install "$version"
rbenv global "$version"
rbenv versions
