#!/usr/bin/env bash
set -Eeu -o pipefail

# Install recommended Ruby release via rbenv.
# Modified 2019-06-19.

# See also:
# - https://github.com/rbenv/ruby-build
# - https://github.com/rbenv/ruby-build/wiki
# - https://github.com/rbenv/ruby-build/issues/377

# shellcheck source=/dev/null
source "${KOOPA_DIR}/shell/bash/include/functions.sh"

assert_is_installed rbenv

# > rbenv install -l

version="$(koopa variable ruby)"

# This step currently fails to build on RHEL 7 with OpenSSL 1.1+.
# Pin to installing with system version (i.e. 1.0.2) instead.

RUBY_CONFIGURE_OPTS=--with-openssl-dir=/usr rbenv install "$version"

rbenv list
