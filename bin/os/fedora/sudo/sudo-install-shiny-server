#!/usr/bin/env bash
set -Eeu -o pipefail

# Install Shiny Server.
# Modified 2019-06-18.

# See also:
# - https://www.rstudio.com/products/rstudio/download-server/

# shellcheck source=/dev/null
source "${KOOPA_DIR}/include/os/fedora/sudo.sh"

tmp_dir="${KOOPA_TMP_DIR}/shiny-server"
version="$(koopa variable shiny-server)"

printf "Installing Shiny Server %s.\n" "$version"

(
    rm -rf "$tmp_dir"
    mkdir -p "$tmp_dir"
    cd "$tmp_dir"
    sudo su - \
        -c "R -e \"install.packages('shiny', repos='https://cran.rstudio.com/')\""
    wget "https://download3.rstudio.org/centos6.3/x86_64/shiny-server-${version}-x86_64.rpm"
    sudo yum install -y --nogpgcheck "shiny-server-${version}-x86_64.rpm"
    rm -rf "$tmp_dir"
)

command -v shiny-server
shiny-server --version
