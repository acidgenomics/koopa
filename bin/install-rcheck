#!/usr/bin/env bash
set -Eeu -o pipefail

KOOPA_PREFIX="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." \
    >/dev/null 2>&1 && pwd -P)"
# shellcheck source=/dev/null
source "${KOOPA_PREFIX}/shell/bash/include/header.sh"

_koopa_assert_has_no_args "$@"

source_repo="https://github.com/acidgenomics/Rcheck.git"
target_dir="$(_koopa_local_app_prefix)/Rcheck"
link_name=".Rcheck"

_koopa_h1 "Installing Rcheck."

# This will clone the Git repo once, if necessary.
if [[ ! -d "$target_dir" ]]
then
    _koopa_h2 "Downloading Rcheck."
    (
        mkdir -pv "$target_dir"
        git clone "$source_repo" "$target_dir"
    ) 2>&1 | tee "$(_koopa_tmp_log_file)"
fi

# Add symlink in current working directory.
_koopa_h2 "Linking Rcheck repo."
ln -fnsv "$target_dir" "$link_name"

_koopa_success "Installation of Rcheck was successful."
