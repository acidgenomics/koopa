#!/usr/bin/env bash
set -Eeuxo pipefail

# Install Miniconda
# https://conda.io/miniconda.html

prefix="${KOOPA_PREFIX}/miniconda3"

# FIXME SWITCH TO CASE.

case "$OSTYPE" in
    linux-gnu) script="Miniconda3-latest-Linux-x86_64.sh";;
      darwin*) script="Miniconda3-latest-MacOSX-x86_64.sh";;
            *) echo "${OSTYPE} is not supported."; exit 1;;
esac

echo "Downloading Miniconda installer..."
curl -O "https://repo.continuum.io/miniconda/${script}"

# Install script flags
# > bash Miniconda3-latest-Linux-x86_64.sh -h
#
# -b           run install in batch mode (without manual intervention),
#              it is expected the license terms are agreed upon
# -f           no error if install prefix already exists
# -h           print this help message and exit
# -p PREFIX    install prefix, defaults to /home/ec2-user/miniconda3, must not contain spaces.
# -s           skip running pre/post-link/install scripts
# -u           update an existing installation
# -t           run package tests after installation (may install conda-build)

bash -c "${script} -b -p ${prefix}"

cat << EOF

conda installed successfully.
Export "CONDA_EXE" in bashrc above koopa activation step and reload the shell.
Use "command -v conda" to check the path.

EOF
