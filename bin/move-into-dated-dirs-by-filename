#!/usr/bin/env bash

# shellcheck source=/dev/null
source "$(koopa header bash)"

# Move files into dated subdirectories by file name.
# Updated 2019-07-28.

# Useful for organizing photos, scans, and videos.

# Examples:
# - 20190101_010101_0001.mov
# - 2019-01-01-01-01-01.pdf

# Ensure we're escaping spaces correctly.
# See also:
# - https://unix.stackexchange.com/questions/9496

[[ -z "${1:-}" ]] &&
    printf "Error: No files were specified.\n" &&
    exit 1

# Consider adding a step that checks all files match here.

for file in "$@"
do
    if [[ "$file" =~ ([0-9]{4})([-_])?([0-9]{2})([-_])?([0-9]{2})([-_])([0-9]{2})([-_])?([0-9]{2})([-_])?([0-9]{2}).+$ ]]
    then
        year="${BASH_REMATCH[1]}"
        month="${BASH_REMATCH[3]}"
        day="${BASH_REMATCH[5]}"
        subdir="${year}/${month}/${day}"
        mkdir -pv "$subdir"
        mv -iv "$file" "$subdir"
    fi
done
