#!/usr/bin/env bash

script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd -P)"
# shellcheck source=/dev/null
source "${script_dir}/../shell/bash/include/header.sh"
koopa::assert_has_no_args "$@"

prefix="$(koopa::app_prefix)/ensembl"
koopa::exit_if_dir "$prefix"

name_fancy="Ensembl Perl API"
koopa::install_start "$name_fancy" "prefix"

(
    koopa::mkdir "$prefix"
    cd "$prefix" || exit 1
    # Install BioPerl.
    git clone -b release-1-6-924 --depth 1 \
        "https://github.com/bioperl/bioperl-live.git"
    git clone "https://github.com/Ensembl/ensembl-git-tools.git"
    git clone "https://github.com/Ensembl/ensembl.git"
    git clone "https://github.com/Ensembl/ensembl-variation.git"
    git clone "https://github.com/Ensembl/ensembl-funcgen.git"
    git clone "https://github.com/Ensembl/ensembl-compara.git"
    git clone "https://github.com/Ensembl/ensembl-io.git"
) 2>&1 | tee "$(koopa::tmp_log_file)"

koopa::set_permissions --recursive "$prefix"
koopa::install_success "$name_fancy"
koopa::restart
