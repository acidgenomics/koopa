#!/usr/bin/env bash
set -Eeu -o pipefail

KOOPA_PREFIX="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." \
    >/dev/null 2>&1 && pwd -P)"
# shellcheck source=/dev/null
source "${KOOPA_PREFIX}/shell/bash/include/header.sh"

_koopa_assert_has_args "$@"
_koopa_assert_is_installed "conda"

name="$1"
force=0

while (("$#"))
do
    case "$1" in
        --force)
            force=1
            shift 1
            ;;
    esac
done

echo "AAA"

if [[ "$force" -eq 1 ]]
then
    echo "BBB"
    conda remove --name "$name" --all
else
    echo "CCC"
    env_prefix="$(_koopa_conda_default_envs_prefix)"
    _koopa_exit_if_dir "${env_prefix}/${name}"
fi

echo "DDD"

_koopa_info "Creating '${name}' conda environment."
conda create -qy --name="$name" "$name"
