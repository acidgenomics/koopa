#!/usr/bin/env bash
set -Eeu -o pipefail

KOOPA_PREFIX="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." \
    >/dev/null 2>&1 && pwd -P)"
# shellcheck source=/dev/null
source "${KOOPA_PREFIX}/shell/bash/include/header.sh"

_koopa_assert_is_installed ssh-keygen

comment="$HOSTNAME"
key_name="id_rsa"

while (("$#"))
do
    case "$1" in
        --comment=*)
            comment="${1#*=}"
            shift 1
            ;;
        --comment)
            comment="$2"
            shift 2
            ;;
        --key-name=*)
            key_name="${1#*=}"
            shift 1
            ;;
        --key-name)
            key_name="$2"
            shift 2
            ;;
        *)
            _koopa_invalid_arg "$1"
            ;;
    esac
done

file="${HOME}/.ssh/${key_name}"
_koopa_exit_if_exists "$file"

ssh-keygen \
    -C "$comment" \
    -N "" \
    -b 4096 \
    -f "$file" \
    -q \
    -t rsa
