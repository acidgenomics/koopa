#!/usr/bin/env bash

script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd -P)"
# shellcheck source=/dev/null
checks=0 source "${script_dir}/../shell/bash/include/header.sh"

koopa::generate_ssh_key() {
    # """
    # Generate SSH key.
    # @note Updated 2020-07-10.
    # This script is called inside 'configure-vm', so don't use assert here.
    # """
    local comment file key_name
    koopa::exit_if_not_installed ssh-keygen
    comment="${USER}@${HOSTNAME}"
    key_name='id_rsa'
    while (("$#"))
    do
        case "$1" in
            --comment=*)
                comment="${1#*=}"
                shift 1
                ;;
            --comment)
                comment="$2"
                shift 2
                ;;
            --key-name=*)
                key_name="${1#*=}"
                shift 1
                ;;
            --key-name)
                key_name="$2"
                shift 2
                ;;
            *)
                koopa::invalid_arg "$1"
                ;;
        esac
    done
    file="${HOME}/.ssh/${key_name}"
    koopa::exit_if_exists "$file"
    ssh-keygen \
        -C "$comment" \
        -N "" \
        -b 4096 \
        -f "$file" \
        -q \
        -t rsa
    koopa::success "Generated SSH key at \"${file}\"."
    return 0
}
