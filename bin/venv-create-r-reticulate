#!/usr/bin/env bash

KOOPA_HOME="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." \
    >/dev/null 2>&1 && pwd -P)"
# shellcheck source=/dev/null
source "${KOOPA_HOME}/shell/bash/include/header.sh"

_koopa_assert_is_installed python3 python

env_name="r-reticulate"
env_base_dir="${1:-"${HOME}/.virtualenvs"}"
env_dir="${env_base_dir}/${env_name}"

rm -frv "$env_dir"
python3 -m venv "$env_dir"
py_exe="${env_dir}/bin/python3"

# Now failing on macOS because of llvmlite, fun.
# llvmlite
# Can't find llvm-config, LLVM_CONFIG

"$py_exe" -m pip install --upgrade pip
"$py_exe" -m pip install Cython
"$py_exe" -m pip install numpy
"$py_exe" -m pip install scikit-learn
"$py_exe" -m pip install numba
"$py_exe" -m pip install umap-learn
"$py_exe" -m pip install louvain
"$py_exe" -m pip list
