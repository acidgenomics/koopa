#!/usr/bin/env bash
set -Eeu -o pipefail

# shellcheck source=/dev/null
source "$(koopa header bash)"



# Usage                                                                     {{{1
# ==============================================================================

usage() {
cat << EOF
find-and-replace [--help|-h] pattern replacement

Global find and replace in files using sed.

required positional arguments:
    1.  Pattern string (i.e. regular expression) passed to sed.
    2.  Replacement string.

details:
    Intended to be used interactively. Searches inside of files in current
    working directory non-recursively (i.e. with a max depth of 1).

    sed syntax:
    s/pattern/replacement/g

note:
    Bash script.
    Updated 2019-09-21.

examples:
    find-and-replace foo bar
EOF
}

[[ -z "${1:-}" ]] && usage && exit 0
_koopa_help "$@"



# Script                                                                    {{{1
# ==============================================================================

from="$1"
to="$2"

# Check for unescaped slashes.
if echo "$from" | grep -q "/" && echo "$from" | grep -Fqv "\\"
then
    >&2 printf "Error: Unescaped '/' detected: %s\n" "$from"
    exit 1
elif echo "$to" | grep -q "/" && echo "$to" | grep -Fqv "\\"
then
    >&2 printf "Error: Unescaped '/' detected: %s\n" "$to"
    exit 1
fi

find . -maxdepth 1 -type f -exec sed -i "s/${from}/${to}/g" {} \;
