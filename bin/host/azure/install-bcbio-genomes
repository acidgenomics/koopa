#!/usr/bin/env bash
set -Eeuo pipefail

# Install bcbio-nextgen genomes.

version="$(bcbio_nextgen.py --version)"
log_dir="${HOME}/logs/${HOSTNAME}/bcbio/${version}"
mkdir -p "$log_dir"

# Clean up tmp files.
rm -rf bcbiotx tmpbcbio-install

bcbio_nextgen.py upgrade \
    --upgrade="skip" \
    --cores="$((CPU_COUNT-4))" \
    --genomes="BDGP6" \
    --genomes="canFam3" \
    --genomes="hg38" \
    --genomes="mm10" \
    --genomes="rn6" \
    2>&1 | tee "${log_dir}/upgrade-genomes-$(date "+%Y%m%d_%H%M%S").log"

rm -rf bcbiotx tmpbcbio-install
