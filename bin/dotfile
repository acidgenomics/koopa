#!/usr/bin/env bash
set -Eeuo pipefail

# Add dot file.
# Modified 2019-06-13.

# Consider adding a `--force` flag to force dot file overwrites.

from_name="$1"
to_name="${2:-}"

dot_dir="${KOOPA_DIR}/dotfiles"
if [[ ! -d "$dot_dir" ]]
then
    >&2 echo "Error: ${dot_dir} missing."
    exit 1
fi

if [[ -z "$to_name" ]]
then
    to_name="$from_name"
fi

from_file="${dot_dir}/${from_name}"
if [[ ! -f "$from_file" ]] && [[ ! -d "$from_file" ]]
then
    >&2 echo "Error: ${from_file} missing."
    exit 1
fi

to_file="${HOME}/.${to_name}"

if [[ ! -L "$to_file" ]] && [[ -f "$to_file" ]]
then
    # Early return if dot file already exists.
    exit 0
elif [[ ! -L "$to_file" ]] && [[ -f "$to_file" ]]
then
    # Error if dot file exists but is not a symlink.
    >&2 echo "Error: ${to_fiile} already exists, but is not a symlink."
    exit 1
fi

rm -f "$to_file"
ln -s "$from_file" "$to_file"
