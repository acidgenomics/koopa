#!/usr/bin/env bash

KOOPA_HOME="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." \
    >/dev/null 2>&1 && pwd -P)"
# shellcheck source=/dev/null
source "${KOOPA_HOME}/shell/bash/include/header.sh"

_koopa_help "$@"
_koopa_assert_has_args "$@"



# Variables                                                                 {{{1
# ==============================================================================

default_home=".emacs.d"
default_dir="${HOME}/${default_home}"



# Arguments                                                                 {{{1
# ==============================================================================

name="$1"
default_dir="${2:-$default_dir}"



# Script                                                                    {{{1
# ==============================================================================

custom_home="${default_home}-${name}"
custom_dir="${HOME}/${custom_home}"

_koopa_assert_is_dir "$custom_dir"
_koopa_assert_is_not_dir "$default_dir"

(
    cd "$HOME" || exit 1
    if [[ "$name" != "ess" ]]
    then
        rm -fv ".emacs"
    elif [[ "$name" != "spacemacs" ]]
    then
        rm -fv ".spacemacs"
    fi
    case "$name" in
        doom)
            link-dotfile --config --force doom
            ;;
        ess)
            link-dotfile --force emacs
            ;;
        spacemacs)
            link-dotfile --force spacemacs
            ;;
        *)
            _koopa_stop "Invalid Emacs config name."
            ;;
    esac
    ln -fnsv "$custom_home" "$default_home"
)
