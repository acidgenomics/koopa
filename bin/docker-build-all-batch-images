#!/usr/bin/env bash

script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd -P)"
# shellcheck source=/dev/null
source "${script_dir}/../shell/bash/include/header.sh"

force=0

while (("$#"))
do
    case "$1" in
        --force)
            force=1
            shift 1
            ;;
        *)
            _koopa_invalid_arg "$1"
            ;;
    esac
done

flags=()

if [[ "$force" -eq 1 ]]
then
    flags+=("--force")
fi

# AWS batch images.
prefix="${HOME}/.config/koopa/docker"
batch_dirs="$( \
    find "$prefix" \
        -name "aws-batch*" \
        -type d \
        | sort \
)"
batch_dirs="$(_koopa_sub "${prefix}/" "" "$batch_dirs")"
readarray -t images <<< "$(_koopa_print "$batch_dirs")"

docker-build-all-images "${flags[@]}" "${images[@]}"
