#!/usr/bin/env bash
set -Eeuo pipefail

# Recursively run shellcheck on all scripts in a directory.

# This script requires shellcheck.
# https://github.com/koalaman/shellcheck
command -v shellcheck >/dev/null 2>&1 || { echo >&2 "shellcheck missing."; exit 1; }

path="${1:-}"
if [[ -z "$path" ]]
then
    path="."
fi

# find . -name "*.sh" -exec shellcheck {} \;

# This step recursively grep matches files with regular expressions.
# Here we're checking for the shebang, rather than relying on file extension.
grep -Elr '#!/usr/bin/env (ba)?sh' "$path" | xargs -I {} shellcheck {}
