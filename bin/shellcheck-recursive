#!/usr/bin/env bash

# Making source header optional, for Travis CI checks.
if [[ -n "$KOOPA_SHELL" ]]
then
    # shellcheck source=/dev/null
    source "$(koopa header bash)"
    _koopa_assert_is_installed shellcheck
fi

# Recursively run shellcheck on all scripts in a directory.
# Modified 2019-06-25.

path="${1:-$PWD}"

# Legacy method:
# > find "$path" -name "*.sh" -exec shellcheck {} \;

# This step recursively grep matches files with regular expressions.
# Here we're checking for the shebang, rather than relying on file extension.
grep -Elr \
    --binary-files="without-match" \
    --exclude "${KOOPA_HOME}/cellar/" \
    '#!/usr/bin/env (ba)?sh' \
    "$path" | \
    xargs -I {} shellcheck -x {}
