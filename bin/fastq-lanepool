#!/usr/bin/env bash
set -Eeu -o pipefail

# Pool lane-split FASTQ files.
# Modified 2019-06-18.

# Set the file stem.
filestem="${1:-lanepool}"

# Exit if lanesplit replicates (L001-4) don't exist.
if [[ -z "$(find . -maxdepth 1 -name '*_L00[1-4]_*.fastq.gz' -print -quit)" ]]
then
    >&2 printf "No lanesplit samples detected.\n"
    exit 1
fi

# SC2035: Use ./*glob* or -- *glob* so names with dashes won't become options.
cat ./*_L00[1-4]_R1_001.fastq.gz > "${filestem}_R1.fastq.gz"
cat ./*_L00[1-4]_R2_001.fastq.gz > "${filestem}_R2.fastq.gz"
cat ./*_L00[1-4]_R3_001.fastq.gz > "${filestem}_R3.fastq.gz"
cat ./*_L00[1-4]_R4_001.fastq.gz > "${filestem}_R4.fastq.gz"
