#!/usr/bin/env bash

script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd -P)"
# shellcheck source=/dev/null
source "${script_dir}/../shell/bash/include/header.sh"

_koopa_current_gencode_version() { # {{{1
    # """
    # Current GENCODE version.
    # @note Updated 2020-07-01.
    # """
    _koopa_assert_has_args_le "$#" 1
    _koopa_assert_is_installed curl
    local base_url organism pattern short_name url x
    organism="${1:-"Homo sapiens"}"
    case "$organism" in
        "Homo sapiens")
            short_name="human"
            pattern="Release [0-9]+"
            ;;
        "Mus musculus")
            short_name="mouse"
            pattern="Release M[0-9]+"
            ;;
        *)
            _koopa_stop "Unsupported organism: '${organism}'."
            ;;
    esac
    base_url="https://www.gencodegenes.org"
    url="${base_url}/${short_name}/"
    x="$( \
        curl --silent "$url" \
        | grep -Eo "$pattern" \
        | head -n 1 \
        | cut -d ' ' -f 2 \
    )"
    [[ -n "$x" ]] || return 1
    _koopa_print "$x"
    return 0
}

_koopa_current_gencode_version "$@"
