#!/usr/bin/env bash

KOOPA_HOME="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." \
    >/dev/null 2>&1 && pwd -P)"
# shellcheck source=/dev/null
source "${KOOPA_HOME}/shell/bash/include/header.sh"

_koopa_help "$@"
_koopa_assert_has_args "$@"



# Arguments                                                                 {{{1
# ==============================================================================

source_dir="$1"
target_dir="$2"

_koopa_assert_is_dir "$source_dir"
_koopa_assert_is_dir "$target_dir"



# Script                                                                    {{{1
# ==============================================================================

source_dir="$(realpath "$source_dir")"
target_dir="$(realpath "$target_dir")"

_koopa_message "\
Source: '${source_dir}'
Target: '${target_dir}'\
"

find -L "$source_dir" \
    -maxdepth 4 \
    -type f \
    \( -name "*.bam" -or -name "*.bam.bai" \) \
    ! -name "*-transcriptome.bam" \
    ! -path "*/work/*" \
    -print0 | xargs -0 -I {} \
        rsync --size-only --progress {} "${target_dir}/"
