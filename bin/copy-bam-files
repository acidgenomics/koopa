#!/usr/bin/env bash

# shellcheck source=/dev/null
source "$(koopa header bash)"

# Copy BAM and BAI index sidecar files to a destination.
# Modified 2019-06-24.

# Source directory.
source_dir="$1"
source_dir="$(realpath "$source_dir")"
if [[ ! -d "$source_dir" ]]
then
    printf "\nDoes not exist:\n%s\n\n" "$source_dir"
    exit 1
fi

# Destination directory.
dest_dir="$2"
dest_dir="$(realpath "$dest_dir")"
if [[ ! -d "$dest_dir" ]]
then
    printf "\nDoes not exist:\n%s\n\n" "$dest_dir"
    exit 1
fi

printf "\nSource:\n%s\n\nDestination:\n%s\n\n" "$source_dir" "$dest_dir"

# Note that we're allowing symlinks in the search path.
# -L  follow symbolic links

find -L "$source_dir" \
    -maxdepth 4 \
    -type f \
    \( -name "*.bam" -o -name "*.bam.bai" \) \
    -print0 | xargs -0 -I {} \
    cp -irv {} "$dest_dir"
