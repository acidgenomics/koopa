#!/usr/bin/env bash

script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd -P)"
# shellcheck source=/dev/null
source "${script_dir}/../shell/bash/include/header.sh"

koopa::copy_bam_files() { # {{{1
    # """
    # Copy BAM files.
    # @note Updated 2020-07-03.
    #
    # Intended primarily for use with bcbio-nextgen.
    # """
    local source_dir target_dir
    koopa::assert_has_args "$#"
    source_dir="$(realpath "${1:?}")"
    target_dir="$(realpath "${2:?}")"
    koopa::dl 'Source' "${source_dir}"
    koopa::dl 'Target' "${target_dir}"
    find -L "$source_dir" \
        -maxdepth 4 \
        -type f \
        \( -name "*.bam" -or -name "*.bam.bai" \) \
        ! -name "*-transcriptome.bam" \
        ! -path "*/work/*" \
        -print0 | xargs -0 -I {} \
            rsync --size-only --progress {} "${target_dir}/"
    return 0
}

koopa::copy_bam_files "$@"
