#!/usr/bin/env Rscript

pkg <- commandArgs(trailingOnly = TRUE)[[1L]]
stopifnot(is.dir(pkg))

repodir <- "~/git/drat"
stopifnot(is.dir(repodir))

devtools::build(pkg)
tarballs <- sort(list.files(
    path = ".",
    pattern = paste0(pkg, "_.*.tar.gz")
))
file <- tail(tarballs, n = 1L)
drat::insertPackage(
    file = file,
    repodir = repodir,
    commit = TRUE,
    pullfirst = TRUE,
    action = "archive"
)
