#!/usr/bin/env bash

## shellcheck source=/dev/null
source "$(koopa header bash)"

## Pull all git repositories recursively.
## Updated 2019-06-23.

git_dir="${1:-.}"

## SC2044: For loops over find output are fragile.
## Using `-L` flag here in case git dir is a symlink.
while IFS= read -r -d '' repo
do
    repo="$(dirname "$repo")"
    (
        cd "$repo" || exit 1
        pwd
        git fetch --all
        git pull --all
        git status
    )
done <   <(find -L "$git_dir" -maxdepth 2 -type d -name ".git" -print0)

unset -v git_dir
