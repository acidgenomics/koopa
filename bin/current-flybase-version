#!/usr/bin/env bash

script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd -P)"
# shellcheck source=/dev/null
source "${script_dir}/../shell/bash/include/header.sh"

koopa::current_flybase_version() { # {{{1
    # """
    # Current FlyBase version.
    # @note Updated 2020-07-01.
    # """
    local dmel url x
    url="ftp://ftp.flybase.net/releases"
    dmel=0
    while (("$#"))
    do
        case "$1" in
            --dmel)
                dmel=1
                shift 1
                ;;
            *)
                koopa::invalid_arg "$1"
                ;;
        esac
    done
    if [[ "$dmel" -eq 1 ]]
    then
        x="$( \
            curl --list-only --silent "${url}/current/" \
            | grep -E "^dmel_r[.0-9]+$" \
            | head -n 1 \
            | cut -d '_' -f 2 \
        )"
    else
        x="$( \
            curl --list-only --silent "${url}/" \
            | grep -E "^FB[0-9]{4}_[0-9]{2}$" \
            | sort \
            | tail -n 1 \
        )"
    fi
    [[ -n "$x" ]] || return 1
    koopa::print "$x"
    return 0
}

koopa::current_flybase_version "$@"
