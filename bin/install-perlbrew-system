#!/usr/bin/env bash
set -Eeu -o pipefail

KOOPA_PREFIX="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." \
    >/dev/null 2>&1 && pwd -P)"
# shellcheck source=/dev/null
source "${KOOPA_PREFIX}/shell/bash/include/header.sh"

_koopa_assert_has_no_args "$@"
_koopa_assert_is_installed perlbrew
_koopa_assert_has_no_envs

_koopa_h1 "Linking system Perl in perlbrew."

if [[ -x "/usr/local/bin/perl" ]]
then
    bin_dir="/usr/local/bin"
elif [[ -x "/usr/bin/perl" ]]
then
    bin_dir="/usr/bin"
else
    _koopa_stop "Failed to detect system Perl."
fi

(
    cd "${PERLBREW_ROOT}/perls" || exit 1
    rm -frv system
    mkdir -pv system
    ln -fnsv "$bin_dir" "system/bin"
)

_koopa_system "Addition of system Perl to perlbrew was successful."
