#!/usr/bin/env bash
set -Eeu -o pipefail

# ShellCheck
#
# See also:
# - Install ShellCheck from source
#   https://github.com/koalaman/shellcheck#compiling-from-source
# - Install GHC and cabal-install from source
#   https://www.haskell.org/downloads/linux/

# shellcheck source=/dev/null
source "${KOOPA_DIR}/include/shell/bash/functions.sh"

prefix="${prefix:-$KOOPA_PREFIX}"
build_dir="${KOOPA_TMP}/build/shellcheck"

version="$(koopa_version shellcheck)"

echo "Copying ${version} binary version to ${prefix}."
(
    rm -rf "$build_dir"
    mkdir -p "$build_dir"
    cd "$build_dir"
    wget -qO- "https://storage.googleapis.com/shellcheck/shellcheck-v${version}.linux.x86_64.tar.xz" | tar -xJv
    cp "shellcheck-v${version}/shellcheck" "${prefix}/bin"
    rm -rf "$build_dir"
)

echo "shellcheck installed successfully."
command -v shellcheck
shellcheck --version
